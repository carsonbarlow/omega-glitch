!function(){var AvatarManager=function(){function e(){y.charges&&(y.charges--,d.detonate_charge(f))}function t(){var e=utils.normalize(y.pos_x,y.pos_y,u[v].x,u[v].y);y.vol_x=e[0]*y.speed,y.vol_y=e[1]*y.speed}function s(e){function s(){y.pos_x=u[v].x,y.pos_y=u[v].y,v++,v>=u.length?a(next_spot):t()}if(x)return y.pos_x+=y.vol_x*e,y.pos_y+=y.vol_y*e,y.vol_x>0&&y.pos_x>u[v].x?void s():y.vol_x<0&&y.pos_x<u[v].x?void s():void(u[v]&&y.vol_y>0&&y.pos_y>u[v].y?s():y.vol_y<0&&y.pos_y<u[v].y&&s())}function a(e){f=e,x=!1,y.pos_x=e.pos_x,y.pos_y=e.pos_y,e.charge&&(y.charges++,e.charge=!1),y.collision=8,w=!1}function n(){a(d.starting_spot)}function i(e){s(e)}function o(){return y}function r(){return w}function l(e){g=e,g.add_subscriber(this)}function _(s){if(!x&&level_ready){if(" "===s)return void e();var a=d.move_leads_to(f,m[s]);a&&(u=a.path.checkpoints.slice(0),u[0].x===y.pos_x&&u[0].y===y.pos_y||u.reverse(),v=1,next_spot=a.spot,t(),x=!0,w=!1,y.collision=2)}}function c(e){d=e}function h(e){y.charges=e}function p(){w=!0,y.vol_x=y.vol_x*-1,y.vol_y=y.vol_y*-1,u.reverse(),v=u.length-1-v,next_spot=f}var g,d,u,v,f,m={a:"west",s:"south",d:"east",w:"north"},y={pos_x:0,pos_y:0,vol_x:0,vol_y:0,speed:500,charges:0,collision:10,radius:10,graphic:{lineWidth:0,fillStyle:"rgba(250,247,91,0.7)",strokeStyle:"#29c8df",shadowColor:"#39b5a6",shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0}},x=!1,w=!1;this.update=i,this.get_avatar=o,this.start_level=n,this.inject_input=l,this.key_pressed=_,this.button_pressed=function(){},this.inject_level_manager=c,this.set_avatar_charges=h,this.get_gate_hit=r,this.hit_gate=p},CONFIG={canvas_id:"game_canvas",fps:60,grid_width:30,grid_height:20,grid_size:20,direction_to_grid_difference:{1:{x:0,y:-1},2:{x:1,y:-1},3:{x:1,y:0},4:{x:1,y:1},5:{x:0,y:1},6:{x:-1,y:1},7:{x:-1,y:0},8:{x:-1,y:-1}},level_button_width:5},DomManager=function(){function e(e){_[e].classList.add("hidden")}function t(e){_[e].classList.remove("hidden")}function s(e){for(var t=1;t<=e;t++){var s=document.getElementById("level_"+t);s.disabled=!1}}function a(e){c.innerHTML="";for(var t=0;t<e.length;t++){var s=document.createElement("div");s.classList.add("play_tip"),s.style.left=e[t].pos_x+"px",s.style.top=e[t].pos_y+"px",s.textContent=e[t].tip_text,c.appendChild(s)}}function n(){return h.value}function i(){for(var e=0;e<=CONFIG.grid_width;e++)for(var t=0;t<=CONFIG.grid_height;t++){var s=document.createElement("div");if(s.classList.add("grid_square"),s.style.top=t*CONFIG.grid_size+"px",s.style.left=e*CONFIG.grid_size+"px",s.style.width=CONFIG.grid_size+"px",s.style.height=CONFIG.grid_size+"px",p.appendChild(s),e<CONFIG.grid_width&&t<CONFIG.grid_height){var a=document.createElement("div"),n="grid_"+(e+1)+"_"+(t+1);a.id=n,a.classList.add("grid_button"),a.style.top=t*CONFIG.grid_size+CONFIG.grid_size/2+"px",a.style.left=e*CONFIG.grid_size+CONFIG.grid_size/2+"px",a.style.width=CONFIG.grid_size+"px",a.style.height=CONFIG.grid_size+"px",g.appendChild(a),input.add_button(n)}}}function o(e,t){l&&l.classList.remove("selected"),l=document.getElementById("grid_"+e+"_"+t),l.classList.add("selected")}function r(){return document.getElementById("charge_setter").value}for(var l,_={start_screen:document.getElementById("start_screen"),select_level:document.getElementById("select_level"),game_complete:document.getElementById("game_complete"),custom_level:document.getElementById("custom_level"),level_editor:document.getElementById("level_editor"),game_background:document.getElementById("game_background")},c=document.getElementById("play_tips"),h=document.getElementById("custom_level_textarea"),p=document.getElementById("grid_bg"),g=document.getElementById("grid"),d=0,u=0,v=1;v<=Object.keys(CONTENT.levels).length;v++){var f=document.createElement("button");f.textContent="lv "+v,f.id="level_"+v,f.classList.add("level_btn"),f.classList.add("left_"+d),f.classList.add("top_"+u),f.disabled=!0,d++,d==CONFIG.level_button_width&&(d=0,u++),_.select_level.appendChild(f),input.add_button("level_"+v)}i(),this.close_screen=e,this.open_screen=t,this.unlock_levels=s,this.place_game_tips=a,this.get_custom_level_input=n,this.select_grid_square=o,this.get_charge_count=r},game;window.onload=function(e){game=new Game};var Game=function(){function e(e){level_ready&&t.update(e)}var t=new GameMaster;level_editor=new LevelEditor,graphics=new Graphics,input=new Input,dom_manager=new DomManager,input.set_up_button_events(),t.inject_graphics(graphics),t.inject_input(input),t.inject_dom_manager(dom_manager),t.inject_level_editor(level_editor),level_editor.inject_game_master(t),level_editor.inject_input(input),level_editor.inject_dom_manager(dom_manager);var s=function(){var t=1e3/CONFIG.fps;next_tick=last_tick=(new Date).getTime();return num_frames=0,function(){for(current_tick=(new Date).getTime();current_tick>next_tick;)delta=(current_tick-last_tick)/1e3,e(delta),next_tick+=t,last_tick=(new Date).getTime();graphics.draw(),num_frames++}}();window.requestAnimationFrame?window.each_frame=function(e){var t=function(){e(),requestAnimationFrame(t)};t()}:window.mozRequestAnimationFrame?window.each_frame=function(e){var t=function(){e(),mozRequestAnimationFrame(t)};t()}:window.each_frame=function(e){setInterval(e,1e3/CONFIG.fps)},window.each_frame(s)},level_ready=!1,GameMaster=function(){function update(e){avatar_manager.update(e),level_manager.update(e)}function inject_graphics(e){graphics=e,graphics.inject_avatar(avatar_manager.get_avatar()),level_manager.inject_graphics(e)}function inject_input(e){input=e,avatar_manager.inject_input(e),input.add_subscriber(this)}function inject_dom_manager(e){dom_manager=e}function inject_level_editor(e){level_editor=e}function start_game(){current_level=6,start_level()}function start_level(){level_manager.clear_level(),graphics.clear_level(),level_manager.setup_level(current_level),dom_manager.place_game_tips(level_manager.get_play_tips()),avatar_manager.start_level(),level_ready=!0}function level_complete(){setTimeout(function(){level_ready=!1,current_level++,current_level>highest_level&&(highest_level=current_level,dom_manager.unlock_levels(highest_level),document.cookie="omega_glitch_level="+highest_level),start_level()},1e3)}function game_complete(){dom_manager.open_screen("game_complete")}function reset_level(){level_ready=!1,start_level()}function button_pressed(button){"campaign"==button?(dom_manager.close_screen("start_screen"),dom_manager.open_screen("select_level"),dom_manager.unlock_levels(highest_level)):"level_editor_back"==button?(dom_manager.close_screen("level_editor"),dom_manager.open_screen("start_screen")):"select_level_back"==button?(dom_manager.close_screen("select_level"),dom_manager.open_screen("start_screen")):"level_"==button.substring(0,6)?(current_level=parseInt(button.substring(6)),start_level(),dom_manager.close_screen("select_level"),dom_manager.open_screen("game_background")):"restart_level"==button?(level_ready=!1,start_level()):"quit_level"==button?(dom_manager.open_screen("select_level"),dom_manager.close_screen("game_background")):"back_to_start"==button?(dom_manager.close_screen("game_complete"),dom_manager.open_screen("start_screen")):"custom"==button?(dom_manager.close_screen("start_screen"),dom_manager.open_screen("custom_level")):"play_custom"==button?(set_up_custom_level(eval(dom_manager.get_custom_level_input())),dom_manager.close_screen("custom_level")):"build"==button&&(dom_manager.close_screen("start_screen"),dom_manager.open_screen("level_editor"))}function read_in_cookie(){var e=document.cookie;e=e.split(";");for(var t=0;t<e.length;t++)if("omega_glitch_level="==e[t].trim().substring(0,19))return parseInt(e[t].substring(20))}function set_up_custom_level(e){CONTENT.levels[0]=e,current_level=0,start_level()}var graphics,input,dom_manager,level_editor,current_level,highest_level=read_in_cookie()||6,avatar_manager=new AvatarManager;level_manager=new LevelManager,avatar_manager.inject_level_manager(level_manager),level_manager.inject_avatar_manager(avatar_manager),level_manager.inject_game_master(this),this.update=update,this.inject_graphics=inject_graphics,this.inject_input=inject_input,this.inject_dom_manager=inject_dom_manager,this.inject_level_editor=inject_level_editor,this.key_pressed=function(){},this.button_pressed=button_pressed,this.start_game=start_game,this.level_complete=level_complete,this.reset_level=reset_level,this.game_complete=game_complete,this.set_up_custom_level=set_up_custom_level},GAME_TEXT={lv1a:'This is you: a malicious little Glitch.  Use "A", "S", "W", and "D" to move.',lv1b:'This is your objective: A system Processor.  Use "Space Bar" to detonate your malware charge to disable it.',lv2a:"Some paths are one way.  Restart the level if you get stuck.",lv2b:"Sometimes you may happen across a malware package from a fallen comrade.  Carry on his work!",lv3a:"Security Routines will stop you in your path.  Be careful.",lv4a:"Firewalls will prevent you from proceeding, though otherwise harmless.",lv4b:"Firewalls are powered from these Generators.  Detonate your malware on them to disable the generator along with their Firewalls.",lv5a:"Security Routines are also powered by their own Generators.  You know what to do...",lv6a:"Some systems take a bit more payload to take down.",lv6b:"You are on your own from here on."},Gate=function(e){function t(){active=!1}function s(){return active}this.pos_x=e.x*CONFIG.grid_size,this.pos_y=e.y*CONFIG.grid_size,this.path=e.p,this.size=10,this.collision=8,active=!0,this.blow_up=t,this.is_active=s,this.graphic={lineWidth:1,fillStyle:"rgba(204, 51, 51, 0.6)",shadowColor:"#6FC3DF",shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0}},GateGenerator=function(e,t){function s(e){n=e,n.add_to_manifest(this,"gate_generators");for(var t=0;t<i.length;t++)i[t].inject_graphics(n),i[t].set_starting_spot(this.spot)}function a(){for(var e=0;e<i.length;e++)i[e].blow_up()}var n;this.spot=t[e.s],this.gates=e.g;var i=e.gp.slice(0);this.pos_x=this.spot.pos_x,this.pos_y=this.spot.pos_y,this.size=10;for(var o=0;o<i.length;o++)i[o]=new GateGeneratorPath(i[o]);this.blow_up=a,this.inject_graphics=s,this.graphic={lineWidth:1,fillStyle:"rgba(204, 104, 51, 0.6)",shadowColor:"#6FC3DF",shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0}},GateGeneratorPath=function(e){function t(e){i=e,this.checkpoints=a(),graphics.add_to_manifest(this,"gate_generator_paths")}function s(e){graphics=e}function a(){o=[],o.push({x:i.pos_x,y:i.pos_y});for(var e,t,s=0;s<r.length;s+=2)e=r[s],t=r[s+1],o.push({x:CONFIG.direction_to_grid_difference[e].x*CONFIG.grid_size*t+o[o.length-1].x,y:CONFIG.direction_to_grid_difference[e].y*CONFIG.grid_size*t+o[o.length-1].y});return o}function n(){graphics.remove_from_manifest(this,"gate_generator_paths"),this.blown_up=!0}var i,o,r=e;this.checkpoints=[],this.graphic={setLineDash:[5,3],lineWidth:2,strokeStyle:"#ff5c33",shadowColor:"#6FC3DF",shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0},this.set_starting_spot=t,this.inject_graphics=s,this.checkpoints=o,this.blow_up=n},Graphics=function(){function e(){g.clearRect(0,0,d,u);for(var e=0;e<v.length;e++)i(v[e]);g.font="bold 20px sans-serif",g.fillStyle="rgba(210,210,210,0.5)",g.fillText("Charges:"+c.charges,33,27)}function t(e){c=e}function s(){for(var e in h)h[e]=[];h.avatar=[c]}function a(e,t){var s=h[t];s.indexOf(e)==-1&&s.push(e)}function n(e,t){var s=h[t];s.indexOf(e)!=-1&&s.splice(s.indexOf(e),1)}function i(e){for(var t=h[e],s=0;s<t.length;s++){g.save();var a=t[s].graphic;for(var n in a)"setLineDash"!=n?g[n]=a[n]:g.setLineDash(a[n]);f[e](t[s]),g.restore()}}function o(e){g.beginPath(),g.arc(e.pos_x,e.pos_y,e.collision,0,2*Math.PI,!0),g.fill(),g.stroke(),e.charge&&_(e)}function r(e){var t=e.pos_x,s=e.pos_y,a=e.size;g.beginPath(),g.moveTo(t-a,s-a),g.lineTo(t+a,s-a),g.lineTo(t+a,s+a),g.lineTo(t-a,s+a),g.lineTo(t-a,s-a),g.fill(),g.stroke()}function l(e){g.beginPath();var t=e.checkpoints;g.moveTo(t[0].x,t[0].y);for(var s=1;s<t.length;s++)g.lineTo(t[s].x,t[s].y);g.stroke()}function _(e){g.fillStyle="rgba(212, 17, 27, 0.6)",g.shadowColor="#d0161e",g.shadowBlur=10,g.shadowOffsetX=0,g.shadowOffsetY=0,g.beginPath(),g.arc(e.pos_x,e.pos_y,4,0,2*Math.PI,!0),g.fill()}var c,h={spots:[],paths:[],objectives:[],patrols:[],patrol_generators:[],gates:[],gate_generators:[],gate_generator_paths:[],avatar:[]},p=document.getElementById(CONFIG.canvas_id),g=p.getContext("2d"),d=p.width,u=p.height,v=["paths","spots","objectives","patrols","patrol_generators","gates","gate_generators","gate_generator_paths","avatar"],f={paths:l,spots:o,objectives:r,patrols:o,patrol_generators:r,gates:r,gate_generators:r,gate_generator_paths:l,avatar:o};this.draw=e,this.clear_level=s,this.inject_avatar=t,this.add_to_manifest=a,this.remove_from_manifest=n};!function(){function e(e,t,s,a){d.beginPath(),d.moveTo(e,t),d.lineTo(s,a),d.closePath(),d.stroke()}function t(){this.points=[{y:Math.floor(Math.random()*u+1)*l,x:Math.floor(Math.random()*v+1)*l}],this.draw=a,this.move=s,this.dir=Math.floor(8*Math.random()+1)}function s(){var e=Math.floor(3*Math.random()-1),t=this.dir+e;t<0&&(t=7),7<t&&(t=0);var s=this.points[this.points.length-1];s.x<10&&(t=2),s.y<10&&(t=4),o.width-10<s.x&&(t=6),o.height-10<s.y&&(t=0),this.dir=t;var a={x:s.x+x[t].x*l,y:s.y+x[t].y*l};this.points.push(a),10<this.points.length&&this.points.shift()}function a(){var e=this.points;for(m=1;m<e.length;m++)r.beginPath(),r.moveTo(e[m-1].x,e[m-1].y),r.lineTo(e[m].x,e[m].y),r.closePath(),r.lineWidth=1,r.strokeStyle=h,r.stroke(),r.lineWidth=10,r.strokeStyle=p,r.stroke()}function n(e){this.snakeys=[];for(var s=0;s<e;s++)this.snakeys.push(new t);this.go=i}function i(){for(var e=0;e<this.snakeys.length;e++)this.snakeys[e].move(),this.snakeys[e].draw()}var o=document.getElementById("game_background");o.width=window.innerWidth,o.height=window.innerHeight;var r=o.getContext("2d");r.translate(.5,.5);var l=12,_="rgba(240,240,240)",c="rgba(0,20,40,0.9)",h="rgba(0,255,255,0.1)",p="rgba(0,100,100,0.1)",g=document.createElement("canvas");g.width=window.innerWidth,g.height=window.innerHeight;var d=g.getContext("2d");d.translate(.5,.5),d.fillStyle=_,d.fillRect(0,0,g.width,g.height);var u=Math.ceil(g.height/l),v=Math.ceil(g.width/l);d.strokeStyle=c;for(var f=1;f<=v;f++)e(f*l,0,f*l,g.height);for(var y=0;y<=u;y++)e(0,y*l,g.width,y*l);for(var y=0;y<=u+v;y++)e(0,y*l-g.width,g.width,y*l),e(0,y*l,g.width,y*l-g.width);var x=[{name:"up",x:0,y:-1},{name:"upright",x:1,y:-1},{name:"right",x:1,y:0},{name:"downright",x:1,y:1},{name:"down",x:0,y:1},{name:"downleft",x:-1,y:1},{name:"left",x:-1,y:0},{name:"upleft",x:-1,y:-1}],w=new n(10);r.drawImage(g,0,0),setInterval(function(){r.globalAlpha=.2,r.drawImage(g,0,0),r.globalAlpha=1,w.go()},1e3/30)}();var Input=function(){function e(e){i.push(e)}function t(){for(var e=0;e<i.length;e++){var t=document.getElementById(i[e]);!function(e){t.addEventListener("mouseup",function(){for(var t=0;t<n.length;t++)n[t].button_pressed(i[e])})}(e)}}function s(e){n.indexOf(e)===-1&&n.push(e)}function a(e){n.indexOf(e)!==-1&&e.splice(n.indexOf(e),1)}var n=[],i=["campaign","select_level_back","level_editor_back","custom","build","restart_level","quit_level","back_to_start","play_custom","add_spot","path_n","path_ne","path_e","path_se","path_s","path_sw","path_w","path_nw"];window.addEventListener("keydown",function(e){for(var t=0;t<n.length;t++)n[t].key_pressed(e.key)}),this.add_subscriber=s,this.remove_subscriber=a,this.set_up_button_events=t,this.add_button=e},LevelEditor=function(){function e(e){o=e}function t(e){r=e,r.add_subscriber(this)}function s(e){l=e}function a(e){"grid_"==e.substring(0,5)?(c=parseInt(e.split("_")[1]),h=parseInt(e.split("_")[2]),l.select_grid_square(c,h)):"add_spot"==e&&n()}function n(){p++;var e={x:c,y:h};_.spots["s"+p]=e,_.start||(_.start="s"+p),i()}function i(){_.charges=parseInt(l.get_charge_count()),o.set_up_custom_level(_)}var o,r,l,_={charges:0,spots:{},paths:[],patrols:[],patrol_generators:[],start:!1,objectives:[],gates:[],gate_generators:[]},c=0,h=0,p=0;this.inject_game_master=e,this.inject_input=t,this.inject_dom_manager=s,this.key_pressed=function(){},this.button_pressed=a},LevelManager=function(){function e(e){c=CONTENT.levels[String(e)],p.set_avatar_charges(c.charges);for(var t in c.spots){var s=new Spot(c.spots[t]);d[t]=s,h.add_to_manifest(s,"spots")}for(this.starting_spot=d[c.start],i=0;i<c.paths.length;i++){var a=new Path(c.paths[i]);a.inject_graphics(h),a.set_starting_spot(d[c.paths[i][0]]),u.push(a)}for(i=0;i<c.objectives.length;i++){var n=new Objective(c.objectives[i],d);h.add_to_manifest(n,"objectives"),v.push(n)}for(i=0;i<c.patrols.length;i++){var o=new Patrol(c.patrols[i]);o.make_path_list(u,d),o.inject_graphics(h),f.push(o)}for(i=0;i<c.patrol_generators.length;i++){var r=new PatrolGenerator(c.patrol_generators[i],d);h.add_to_manifest(r,"patrol_generators"),m.push(r)}for(i=0;i<c.gates.length;i++){var l=new Gate(c.gates[i]);h.add_to_manifest(l,"gates"),y.push(l)}for(i=0;i<c.gate_generators.length;i++){var _=new GateGenerator(c.gate_generators[i],d);_.inject_graphics(h),x.push(_)}if(c.tips)for(i=0;i<c.tips.length;i++)w.push(new PlayTip(c.tips[i]))}function t(e,t){if(!e[t])return!1;var s={spot:d[e[t][0]],path:u[e[t][1]]};return!s.path.blocked&&s}function s(e){h=e}function a(e){p=e}function n(e){g=e}function o(e){for(var t=0;t<v.length;t++)if(v[t].spot==e){v[t].blow_up(),h.remove_from_manifest(v[t],"objectives");for(var s=v[t].paths.length-1;s>-1;s--){u[v[t].paths[s]].blow_up();for(var a=0;a<f.length;a++)f[a].get_current_path()===u[v[t].paths[s]]&&f[a].blow_up()}v.splice(t,1),v.length||(c.end_of_game?g.game_complete():g.level_complete())}for(t=0;t<m.length;t++)if(m[t].spot==e){m[t].blow_up();for(var a=m[t].patrols.length-1;a>-1;a--)f[m[t].patrols[a]].blow_up(),h.remove_from_manifest(f[m[t].patrols[a]].get_unit(),"patrols");h.remove_from_manifest(m[t],"patrol_generators")}for(t=0;t<x.length;t++)if(x[t].spot==e){x[t].blow_up();for(var n=x[t].gates.length-1;n>-1;n--)y[x[t].gates[n]].blow_up(),h.remove_from_manifest(y[x[t].gates[n]],"gates"),u[y[x[t].gates[n]].path].blocked=!1,h.remove_from_manifest(x[t],"gate_generators")}}function r(){return w}function l(){d={},u=[],v=[],f=[],m=[],y=[],x=[],w=[]}function _(e){for(var t=0;t<f.length;t++)f[t].update(e),f[t].is_active()&&utils.check_collision(f[t].get_unit(),p.get_avatar())&&g.reset_level();for(t=0;t<y.length;t++)y[t].is_active()&&!p.get_gate_hit()&&utils.check_collision(y[t],p.get_avatar())&&p.hit_gate()}var c,h,p,g,d,u,v,f,m,y,x,w;this.starting_spot,this.setup_level=e,this.inject_graphics=s,this.inject_avatar_manager=a,this.inject_game_master=n,this.get_play_tips=r,this.move_leads_to=t,this.detonate_charge=o,this.clear_level=l,this.update=_},Objective=function(e,t){function s(){}this.spot=t[e[0]],this.paths=e[1],this.size=15,this.pos_x=this.spot.pos_x,this.pos_y=this.spot.pos_y,this.graphic={lineWidth:1,fillStyle:"rgba(250,247,91,0.2)",shadowColor:"#6FC3DF",shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0},this.blow_up=s},Path=function(e){function t(e){o=e,this.checkpoints=a(),i.add_to_manifest(this,"paths")}function s(e){i=e}function a(){r=[],r.push({x:o.pos_x,y:o.pos_y});for(var t,s,a=1;a<e.length;a+=2)t=e[a],s=e[a+1],r.push({x:CONFIG.direction_to_grid_difference[t].x*CONFIG.grid_size*s+r[r.length-1].x,y:CONFIG.direction_to_grid_difference[t].y*CONFIG.grid_size*s+r[r.length-1].y});return r}function n(){this.blocked=!0,this.blown_up=!0,this.graphic.strokeStyle="rgba(209, 243, 248, 0.25)",this.graphic.shadowBlur=0}var i,o,r;this.graphic={lineWidth:2,strokeStyle:"rgba(209, 243, 248, 1)",shadowColor:"#6FC3DF",shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0},this.set_starting_spot=t,this.inject_graphics=s,this.checkpoints=r,this.blow_up=n},Patrol=function(e){function t(e){p=e,p.add_to_manifest(y,"patrols")}function s(e,t){g=[];for(var s=0;s<m.length;s++)g.push(e[a(t[m[s]],m[(s+1)%m.length])]);y.pos_x=t[m[0]].pos_x,y.pos_y=t[m[0]].pos_y,u=-1,v=1,o()}function a(e,t){for(var s=0;s<w.length;s++)if(e[w[s]]&&e[w[s]][0]==t)return e[w[s]][1]}function n(e){x&&i(e)}function i(e){function t(){y.pos_x=d[f].x,y.pos_y=d[f].y,f++,f>=d.length?o():r()}y.pos_x+=y.vol_x*e,y.pos_y+=y.vol_y*e,y.vol_x>0&&y.pos_x>d[f].x?t():y.vol_x<0&&y.pos_x<d[f].x&&t(),y.vol_y>0&&y.pos_y>d[f].y?t():y.vol_y<0&&y.pos_y<d[f].y&&t()}function o(){u=(u+v+m.length)%m.length,d=g[u],d.blown_up&&(v=-v,u=(u+2*v+m.length)%m.length,d=g[u]),d=d.checkpoints.slice(0),d[0].x===y.pos_x&&d[0].y===y.pos_y||d.reverse(),f=1,r()}function r(){var e=utils.normalize(y.pos_x,y.pos_y,d[f].x,d[f].y);y.vol_x=e[0]*y.speed,y.vol_y=e[1]*y.speed}function l(){return y}function _(){return x}function c(){x=!1}function h(){return g[u]}var p,g,d,u,v,f,m=e,y={pos_x:0,pos_y:0,vol_x:0,vol_y:0,speed:75,collision:10,graphic:{lineWidth:0,fillStyle:"rgba(207, 19, 28, 0.8)",shadowColor:"#6FC3DF",shadowBlur:20,shadowOffsetX:0,shadowOffsetY:0}},x=!0,w=["north","east","west","south"];this.make_path_list=s,this.update=n,this.inject_graphics=t,this.get_unit=l,this.get_current_path=h,this.blow_up=c,this.is_active=_},PatrolGenerator=function(e,t){function s(){}this.spot=t[e.s],this.patrols=e.p,this.pos_x=this.spot.pos_x,this.pos_y=this.spot.pos_y,this.size=10,this.blow_up=s,this.graphic={lineWidth:1,fillStyle:"rgba(84, 84, 51, 0.6)",shadowColor:"#6FC3DF",shadowBlur:5,shadowOffsetX:0,shadowOffsetY:0}},PlayTip=function(e){this.tip_text=GAME_TEXT[e.t],this.pos_x=e.x,this.pos_y=e.y},Spot=function(e){this.pos_x=e.x*CONFIG.grid_size,this.pos_y=e.y*CONFIG.grid_size,this.north=e.n,this.east=e.e,this.south=e.s,this.west=e.w,this.charge=e.charge||!1,this.collision=CONFIG.grid_size/2,this.graphic={fillStyle:"rgba(254, 254, 254, 0.8)",lineWidth:2,strokeStyle:"#29c8df",shadowColor:"#5ad4e6",shadowBlur:10,shadowOffsetX:0,shadowOffsetY:0}},Utils=function(){function e(e,t,s,a){x_dif=s-e,y_dif=a-t;var n=x_dif*x_dif+y_dif*y_dif;return n=Math.sqrt(n),[x_dif/n,y_dif/n]}function t(e,t){return s(e,t)<e.collision+t.collision}function s(e,t){var s=e.pos_x-t.pos_x,a=e.pos_y-t.pos_y;return Math.sqrt(s*s+a*a)}this.normalize=e,this.check_collision=t};utils=new Utils;var CONTENT=CONTENT||{levels:{}};CONTENT.levels[1]={charges:1,spots:{s1:{x:8,y:15,e:["s2",0]},s2:{x:20,y:15,w:["s1",0],e:["s3",1]},s3:{x:35,y:15,w:["s2",1]}},paths:[["s1",3,12],["s2",3,15]],patrols:[],patrol_generators:[],start:"s1",objectives:[["s3",[0,1]]],gates:[],gate_generators:[],tips:[{x:20,y:140,t:"lv1a"},{x:420,y:110,t:"lv1b"}]};var CONTENT=CONTENT||{levels:{}};CONTENT.levels[2]={charges:0,spots:{s1:{x:8,y:15,e:["s2",0]},s2:{x:20,y:15,w:["s1",0],e:["s3",1],n:["s4",2]},s3:{x:35,y:15,w:["s2",1],charge:!0},s4:{x:18,y:10}},paths:[["s1",3,12],["s2",3,15],["s2",1,3,8,2]],patrols:[],patrol_generators:[],start:"s1",objectives:[["s4",[0,1,2]]],gates:[],gate_generators:[],tips:[{x:140,y:60,t:"lv2a"},{x:420,y:120,t:"lv2b"}]};var CONTENT=CONTENT||{levels:{}};CONTENT.levels[3]={charges:1,spots:{s1:{x:8,y:15,e:["s2",0]},s2:{x:12,y:15,w:["s1",0],e:["s4",1],n:["s3",2]},s3:{x:12,y:10,s:["s2",2]},s4:{x:16,y:15,w:["s2",1],e:["s5",3]},s5:{x:20,y:15,w:["s4",3],e:["s6",4]},s6:{x:24,y:15,w:["s5",4],e:["s7",5],s:["s8",6]},s7:{x:30,y:11,s:["s6",5]},s8:{x:30,y:19,w:["s6",6]}},paths:[["s1",3,4],["s2",3,4],["s2",1,5],["s4",3,4],["s5",3,4],["s6",3,3,2,3,1,1],["s6",5,2,4,2,3,4]],start:"s1",objectives:[["s7",[0,1,2,3,4,5,6]]],patrols:[["s3","s2","s4","s5","s6","s8","s6","s5","s4","s2"]],patrol_generators:[{s:"s8",p:[0]}],gates:[],gate_generators:[],tips:[{x:130,y:260,t:"lv3a"}]};var CONTENT=CONTENT||{levels:{}};CONTENT.levels[4]={charges:2,spots:{s1:{x:9,y:7,s:["s2",0]},s2:{x:10,y:12,n:["s1",0],e:["s3",1]},s3:{x:14,y:12,w:["s2",1],e:["s4",2],n:["s7",5]},s4:{x:22,y:14,w:["s3",2],e:["s5",3],s:["s6",4]},s5:{x:25,y:11,s:["s4",3]},s6:{x:20,y:17,e:["s4",4]},s7:{x:20,y:8,w:["s3",5]}},paths:[["s1",5,2,4,1,5,2],["s2",3,4],["s3",3,2,4,2,3,4],["s4",3,2,2,1,1,2],["s4",5,2,6,1,7,1],["s3",1,2,2,2,3,4]],start:"s1",objectives:[["s5",[0,1,2,3,4,5]]],patrols:[["s6","s4","s3","s4"]],patrol_generators:[{s:"s6",p:[0]}],gates:[{x:20,y:14,p:2}],gate_generators:[{s:"s7",g:[0],gp:[[5,6]]}],tips:[{x:50,y:230,t:"lv4a"},{x:330,y:40,t:"lv4b"}]};var CONTENT=CONTENT||{levels:{}};CONTENT.levels[5]={charges:1,spots:{s1:{x:8,y:20,n:["s2",0]},s2:{x:9,y:13,s:["s1",0],n:["s3",1],e:["s4",2]},s3:{x:6,y:12,n:["s2",1],charge:!0},s4:{x:16,y:15,w:["s2",2],s:["s5",3],e:["s7",6]},s5:{x:15,y:20,n:["s4",3],s:["s6",4]},s6:{x:22,y:20,w:["s5",4],n:["s7",5]},s7:{x:19,y:15,w:["s4",6],s:["s6",5],e:["s8",7]},s8:{x:23,y:10,s:["s7",7],w:["s9",8]},s9:{x:19,y:11,e:["s8",8]}},paths:[["s1",1,3,2,1,1,3],["s2",1,2,2,1,1,3,8,1,7,3,6,1,5,2,4,1,5,2],["s2",3,2,4,2,3,3],["s4",5,2,6,1,5,2],["s5",5,1,6,9,3,1,2,10,3,1,6,10,3,1,2,10,3,1,6,10,3,1,2,10,3,1],["s6",1,1,8,3,1,1],["s4",3,3],["s7",3,2,2,2,1,3],["s8",7,2,6,1,7,1]],start:"s1",objectives:[["s8",[0,1,2,3,4,5,6,7,8]]],patrols:[["s5","s4","s7","s6"]],patrol_generators:[{s:"s5",p:[0]}],gates:[{x:18,y:15,p:6}],gate_generators:[{s:"s9",g:[0],gp:[[5,1,6,1,5,2]]}],tips:[{x:280,y:360,t:"lv5a"}]};var CONTENT=CONTENT||{levels:{}};CONTENT.levels[6]={charges:4,spots:{s1:{x:28,y:18,n:["s2",0]},s2:{x:20,y:14,e:["s1",0],s:["s3",1]},s3:{x:8,y:18,n:["s2",1],w:["s4",2]},s4:{x:4,y:10,s:["s3",2],n:["s5",3],e:["s9",8]},s5:{x:9,y:4,w:["s4",3],e:["s6",4],n:["s10",9]},s6:{x:15,y:4,w:["s5",4],n:["s7",5]},s7:{x:22,y:1,w:["s6",5],s:["s8",6]},s8:{x:19,y:8,e:["s7",6],w:["s9",7]},s9:{x:14,y:9,e:["s8",7],w:["s4",8]},s10:{x:6,y:1,e:["s5",9]}},paths:[["s1",1,2,8,2,7,6],["s2",5,3,6,2,8,2,1,3,7,6,6,2,5,2],["s3",7,2,8,2,1,6],["s4",1,3,2,3,3,2],["s5",3,6],["s6",1,2,2,1,3,6],["s7",5,6,6,1,7,2],["s8",7,2,6,1,7,2],["s9",7,6,6,1,7,3],["s5",1,2,8,1,7,2]],start:"s1",objectives:[["s4",[0,1,2,3,8,7,6]],["s7",[5,4,9,3]]],patrols:[["s10","s5","s6","s7","s8","s9","s4","s5"],["s8","s9","s4","s5","s10","s5","s6","s7"]],patrol_generators:[{s:"s10",p:[0,1]}],gates:[{x:11,y:9,p:8}],gate_generators:[{s:"s9",g:[0],gp:[[6,1,7,1,8,1]]}],tips:[{x:120,y:-70,t:"lv6a"},{x:320,y:300,t:"lv6b"}],end_of_game:!0};var CONTENT=CONTENT||{levels:{}};CONTENT.levels[7]={charges:0,spots:{s1:{x:8,y:15,e:["s2",0]},s2:{x:20,y:15,w:["s1",0],e:["s3",1]}},paths:[],patrols:[],patrol_generators:[],start:"s1",objectives:[],gates:[],gate_generators:[]}}();